#!/usr/bin/env coffee
# -*- mode: coffee; -*-

util = require "util"
async = require "async"

{ ReplHelper } = require "./lib/repl"
{ Application } = require "../lib/application"

# create a new application for scripting
class AxleRepl extends Application
  @controllersPath = "#{ __dirname }/../../api/app/controller"

finish = ( app ) ->
  app.app.close()
  app.redisClient.quit()

axle = new AxleRepl()
axle.redisConnect ( ) ->
  axle.run "127.0.0.1", 28902, ( ) ->
    axle.configureControllers()
    axle.configureModels()
    axle.configureMiddleware()

    replHelper = new ReplHelper axle

    # make sure we shutdown connections
    replHelper.initReadline ( ) ->
      finish axle

    replHelper.topLevelInput()
